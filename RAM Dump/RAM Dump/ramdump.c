/*
 * ramdump.c
 *
 * Created: 26-Mar-19 2:33:21 PM
 * Author: Ranul Deepanayake
 */ 

#include "ramdump.h"

#ifdef RAM_DUMP_TEST_MODE
uint8_t ram_dump_test_data[RAM_DUMP_DATA_SET_SIZE]=  {
	0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 
	0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 
	0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 
	0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 
	0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64
	};	//Test data set.
#endif

/**
Reads the contents of RAM between defined starting and ending addresses and dumps them out via UART using a loop.
Supports a test mode.
*/
void ramdump_dump_serial(void){
	uint8_t *pointer;	//Create a byte sized pointer to read memory locations.
	char temp[17];	
	
	#ifdef RAM_DUMP_TEST_MODE
	uint8_t test= ram_dump_test_data[0];	//For testing.
	test++;	//To suppress compiler warnings.
	#endif
	

	uart_println("----Start of dump----\n");
	uart_println("Address \t Value");
	for(uint16_t i= RAM_DUMP_READ_START_LOCATION; i<= RAM_DUMP_READ_STOP_LOCATION; i++){
		pointer= (uint8_t*)i;	//Cast integer address to pointer address.
		sprintf(temp, "0x%04X \t\t 0x%02X", i, *pointer);		//Print both memory address and content.
		uart_println(temp);
	}
	uart_println("\n----End of dump----");
}

/**
Under development.
*/
void ramdump_dump_eeprom(void);

/**
Under development.
*/
void ramdump_dump_sd(void);